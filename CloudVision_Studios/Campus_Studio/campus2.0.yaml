-
    service: arista.studio.v1.StudioConfigService
    method: Set
    body:
        value:
            key:
                studio_id: studio-campus
                workspace_id: &workspace_id ws-campus
            display_name: 'Campus Fabric'
            description: 'Deploy and manage an Arista validated L2 MLAG campus fabric, and configure networks within the campus.'
            template:
                type: TEMPLATE_TYPE_MAKO
                body: |
                    <%
                    import sys, os, json, ipaddress
                    import tagsearch_python.tagsearch_pb2_grpc as tsgr
                    import tagsearch_python.tagsearch_pb2 as tspb

                    myDevice = ctx.getDevice()
                    myDeviceID = myDevice.id
                    myRole = None
                    devsInCampus = {}
                    devsInPod = {}
                    myCampus = None
                    myPod = None
                    campusLabel = 'Campus'
                    campusPodLabel = 'Campus-Pod'
                    hostnameLabel = 'hostname'

                    tsclient = ctx.getApiClient(tsgr.TagSearchStub)

                    #get all Campuses
                    tvs = tspb.TagValueSearchRequest(label=campusLabel, workspace_id=ctx.studio.workspaceId, topology_studio_request=True)
                    tvsresp = tsclient.GetTagValueSuggestions(tvs)
                    for tag in tvsresp.tags:
                      tagtmr = tspb.TagMatchRequestV2(query='%s:"%s"' % (tag.label, tag.value), workspace_id=ctx.studio.workspaceId, topology_studio_request=True)
                      tagresp = tsclient.GetTagMatchesV2(tagtmr)
                      for match in tagresp.matches:
                        devsInCampus.setdefault(tag.value, [])
                        devsInCampus[tag.value].append(match.device.device_id)
                        if match.device.device_id == myDeviceID:
                          assert not myCampus, "Device %s not allowed to be in two campuses (%s, %s)" %(myDeviceID, myCampus, tag.value)
                          myCampus = tag.value

                    #get all Campus Pods
                    tvs = tspb.TagValueSearchRequest(label=campusPodLabel, workspace_id=ctx.studio.workspaceId, topology_studio_request=True)
                    tvsresp = tsclient.GetTagValueSuggestions(tvs)
                    for tag in tvsresp.tags:
                      tagtmr = tspb.TagMatchRequestV2(query='%s:"%s"' % (tag.label, tag.value), workspace_id=ctx.studio.workspaceId, topology_studio_request=True)
                      tagresp = tsclient.GetTagMatchesV2(tagtmr)
                      for match in tagresp.matches:
                        devsInPod.setdefault(tag.value, [])
                        devsInPod[tag.value].append(match.device.device_id)
                        if match.device.device_id == myDeviceID:
                          assert not myPod, "Device %s not allowed to be in two PODs (%s, %s)" %(myDeviceID, myPod, tag.value)
                          myPod = tag.value
                          myRole = "leaf"

                    if not myCampus:
                        # non-campus devices that this studio is assigned to. Just ignore them so the studio can be assigned to a broader category of devices
                        ctx.error("! This device %s is not in a campus. Not generating configuration for it" %myDeviceID)
                        return

                    devsInMyCampus = devsInCampus[myCampus]
                    podsInMyCampus = []
                    for dev in devsInMyCampus:
                      for pod, devs in devsInPod.items():
                        if dev in devs:
                          if pod not in podsInMyCampus:
                            podsInMyCampus.append(pod)
                    podsInMyCampus = list(set(podsInMyCampus))

                    mySplineRole = myLeafRole = podDevices = None
                    commonVlans = []
                    campus = campusPicker.resolve()["campus"]
                    fabricType = campus.get("fabricType")
                    commonVlans = campus.get("commonVlans", [])
                    commonMlagConfig = campus.get("commonMlagConfig")
                    lacpMode = commonMlagConfig["lacpMode"]
                    mlagVlan = commonMlagConfig.get("mlagVlan")
                    virtualRouterMacAddress = commonMlagConfig.get("virtualRouterMacAddress")
                    mlagPortChannelId = commonMlagConfig.get("mlagPortChannelId")
                    mlagIPSubnet = commonMlagConfig.get("mlagPeerLinkSubnet")
                    mlagSubnetMask = commonMlagConfig.get("mlagSubnetMask")
                    # check MLAG subnet and size of MLAG Subnet mask
                    mlag_subnet = ipaddress.ip_network(mlagIPSubnet)
                    mlag_subnet_mask = mlagSubnetMask
                    if mlag_subnet_mask != mlag_subnet.prefixlen:
                      mlag_subnet = list(mlag_subnet.subnets(new_prefix=mlag_subnet_mask))[ int(self.leaf_domain) - 1 ]
                    mlagRole = None    # Primary/Secondary
                    peerLinkMembers = []

                    #Ensure that there is only one management VLAN
                    mgmtVlans = [vlan for vlan in commonVlans if vlan["commonVlanIsMgmt"]]
                    if len(mgmtVlans) > 1:
                      raise Exception("More than one management VLAN specified: %r" %[vlan["commonVlanID"] for vlan in mgmtVlans])

                    # Roles of devices:
                    # 1. Spline - Primary/Secondary/None
                    # 2. Leaf - Primary/Secondary/Member/None
                    # myRole: spline/leaf
                    # mySplineRole: primary/secondary
                    # myLeafRole: primary/secondary/member

                    # Gather all splines
                    # A little odd that we determine splines by inputs, but pods by tag
                    splinePicker = campus.get("splinePicker")
                    splines = []    # list of Device objects
                    for dev in devsInMyCampus:
                      sp = splinePicker.resolve(device=dev)
                      # it's considered a spline if it's got the Role filled in
                      if sp and sp.get("spline") and sp.get("spline").get("splineRole"):
                          splines.append(dev)

                    downlinkDetails = {}
                    spline = {}
                    inbandMgmtIPSubnet = None
                    if splinePicker and splinePicker.resolve().get("spline"):
                      spline = splinePicker.resolve().get("spline")
                      inbandMgmtIPSubnet = spline.get("splineInbandMgmtIPSubnet")
                      mlagRole = mySplineRole = spline.get("splineRole")
                      if mlagRole:
                        assert not myPod, "Spline inputs cannot be specified for a device that has the POD tag %s" %myPod
                        myRole = "spline"

                    if myRole == "spline":
                      # Allocate a port-channel number for each downlink to POD, starting with 11
                      # for each connected interface, check if it's connected to a pod
                      for intf in myDevice.getInterfaces():
                        peer_device, peer_interface = intf.getPeerInfo()
                        if peer_device is None:
                          continue
                        if peer_device.id == myDeviceID:
                          # sanity check that you're not connected to yourself
                          continue
                        if peer_device.id in splines:
                          ctx.info("Interface %s connected to peer spline %s over peer interface %s (assuming mlag peer link)" %(intf.name, peer_device.id, peer_interface.name))
                          peerLinkMembers.append(intf.name)
                        # sort by pod name so all switches have the same view
                        for podIndex, pod in enumerate(sorted(devsInPod.keys()), 1):
                          if peer_device.id not in devsInPod[pod]:
                            ctx.info("Ignoring connection to peer device %s over peer interface %s because it's not in a pod" %(peer_device.id, peer_interface.name))
                            continue
                          ctx.info("Interface %s connected to peer device %s over peer interface %s in pod %s" %(intf.name, peer_device.id, peer_interface.name, pod))
                          pch = 10 + podIndex
                          downlinkDetails[intf.name] = {'downlinkInterfaceParameters': {'downlinkChannelNum': pch}}

                      externalUplinkDetails = {}
                      externalUplinkResolver = spline.get("externalUplinkResolver")
                      if externalUplinkResolver:
                        for intf in myDevice.getInterfaces():
                          intfName = intf.name
                          val = externalUplinkResolver.resolve(intfName, strict=True)
                          if val:
                            externalUplinkDetails[intfName] = val.get("externalUplink")

                    if myRole != "spline" and myRole != "leaf":
                        # non-campus devices that this studio is assigned to. Just ignore them so the studio can be assigned to a broader category of devices
                        ctx.error("Device %s is not a spline or in a POD. Not generating configuration for it." %myDeviceID)
                        return

                    podDevices = []   # List of device IDs
                    if myPod:
                        podDevices = devsInPod.get(myPod)
                        podDevices = list(set(podDevices))

                    allLeafRoles = {}
                    pod = campus["podPicker"].resolve()["pod"]
                    leafs = pod["leafs"]
                    for dev in podDevices:
                      lf = leafs.resolve(device=dev)
                      if lf and lf.get("leaf"):
                        allLeafRoles[dev] = lf.get("leaf").get("leafRole")
                    podMembers = [d for d in podDevices if allLeafRoles.get(d) == "Member"]
                    leaf = leafs.resolve().get("leaf")
                    if myRole == "leaf":
                      myLeafRole = leaf["leafRole"]
                      inbandMgmtIPSubnet = leaf.get("leafInbandMgmtIPSubnet")
                      # We could add a check that inbandMgmtIPSubnet must be specified if there's a management VLAN
                      if myLeafRole == "Primary" or myLeafRole == "Secondary":
                        mlagRole = myLeafRole
                      if myLeafRole == "Secondary":
                          assert len(podDevices) >= 2, "There must be at least 2 devices in the POD if there is a secondary (currently %r)" %podDevices

                      leafUplinkDetails = {}
                      # pick uplink port channel number depending on where my pod is in the sorted list of pods
                      for intf in myDevice.getInterfaces():
                        peer_device, peer_interface = intf.getPeerInfo()
                        if peer_device is None:
                          continue
                        if peer_device.id == myDeviceID:
                          # sanity check that you're not connected to yourself
                          continue
                        if myLeafRole == "Primary" or myLeafRole == "Secondary" or myLeafRole == "None":
                          if peer_device.id in podDevices and peer_device.id not in podMembers:
                            ctx.info("Interface %s connected to peer leaf %s over peer interface %s (assuming mlag peer link)" %(intf.name, peer_device.id, peer_interface.name))
                            peerLinkMembers.append(intf.name)
                          pch = 11 + sorted(devsInPod.keys()).index(myPod)
                          for spline in splines:
                            if peer_device.id == spline:
                              ctx.info("Interface %s connected to spline %s over peer interface %s" %(intf.name, peer_device.id, peer_interface.name))
                              leafUplinkDetails[intf.name] = {"leafUplinkChannelGroup": pch}
                              break
                          # TODO: Add a warning if the number of leaf uplinks is not equal to the number of splines
                        elif myLeafRole == "Member":
                          peerRole = allLeafRoles.get(peer_device.id)
                          pch = 21 + sorted(podMembers).index(myDeviceID)
                          ctx.info("Interface %s connected to peer %s, role %s over peer interface %s" %(intf.name, peer_device.id, peerRole, peer_interface.name))
                          leafUplinkDetails[intf.name] = {"leafUplinkChannelGroup": pch}
                          # TODO: Add a warning if the number of uplinks is not 1 or 2 depending on pod primary/secondary

                      leafDownlinkDetails = {}
                      if myLeafRole == "Primary" or myLeafRole == "Secondary" or myLeafRole == "None":
                        # Allocate a port-channel number for each member in the POD
                        # Start at 21, sort by device ID, and increment
                        for intf in myDevice.getInterfaces():
                          peer_device, peer_interface = intf.getPeerInfo()
                          if peer_device is None:
                            continue
                          if peer_device.id not in podMembers:
                            continue
                          pch = 21 + sorted(podMembers).index(peer_device.id)
                          leafDownlinkDetails[intf.name] = {"leafDownlinkChannelGroup": pch}
                        # TODO: Add a warning if the number of leaf downlinks is not equal to the number of members

                    myMlagIP = None
                    peerMlagIP = None
                    if mlagRole == "Primary":
                      myMlagIP = str(list(mlag_subnet.hosts())[0])
                      peerMlagIP = str(list(mlag_subnet.hosts())[1])
                    else:
                      myMlagIP = str(list(mlag_subnet.hosts())[1])
                      peerMlagIP = str(list(mlag_subnet.hosts())[0])

                    %>\

                    banner motd
                    Device ID: ${myDeviceID}
                    Role: ${myRole} ${mySplineRole or myLeafRole or ""}
                      %  if myRole == "leaf":
                    POD: ${myPod}
                    Devices in this POD: ${', '.join(sorted(podDevices))}
                    %  endif
                    PODs in this campus: ${', '.join(sorted(podsInMyCampus))}
                    Devices in this campus: ${', '.join(sorted(devsInMyCampus))}
                    Description: Campus Switch
                    Access by authorized users only!
                    EOF

                    %  for vlan in commonVlans:
                    vlan ${vlan["commonVlanID"]}
                        name ${vlan["commonVlanName"]}
                    %  endfor

                    %  if myRole == "spline":
                    ip dhcp relay information option
                    ip dhcp relay always-on

                    %    if inbandMgmtIPSubnet:
                    interface Loopback2
                        description Inband Mgmt
                        ip address ${inbandMgmtIPSubnet}
                    %    endif

                    %    for vlan in commonVlans:
                    %      if vlan["commonVlanVIP"] or vlan["IPHelperAddress"] or vlan["vrf"]:
                    %      if vlan["vrf"]:
                    vrf instance ${vlan["vrf"]}
                    ip routing vrf ${vlan["vrf"]}
                    %      endif
                    interface vlan ${vlan["commonVlanID"]}
                    %        if vlan["vrf"]:
                        vrf ${vlan["vrf"]}
                    %        endif
                    %        if vlan["commonVlanVIP"]:
                        ip virtual-router address ${vlan["commonVlanVIP"]}
                        no autostate
                    %        endif
                    %        if mgmtVlans and vlan.get("IPHelperAddress"):
                        ip helper-address 127.0.0.1 source-interface vlan ${mgmtVlans[0]["commonVlanID"]}
                    %        endif
                    %        if vlan.get("IPHelperAddress"):
                        ip helper-address ${vlan["IPHelperAddress"]}
                    %        endif
                    %      endif
                    %    endfor
                    %    for vlan in spline.get("splineVlans", []):
                    %      if vlan["splineVlanIPSubnet"]:
                    interface vlan ${vlan["splineVlanID"]}
                    %        if vlan["primarySecondary"] == "Primary":
                        ip address ${vlan["splineVlanIPSubnet"]}
                    %        elif vlan["primarySecondary"] == "Secondary": # new line
                        ip address ${vlan["splineVlanIPSubnet"]} secondary
                    %        endif
                    %      endif
                    !
                    %    endfor
                    %  elif myRole == "leaf":
                    %    if mgmtVlans:
                    interface vlan ${mgmtVlans[0]["commonVlanID"]}
                        description In band management
                    %      if inbandMgmtIPSubnet:
                        no autostate
                        ip address ${inbandMgmtIPSubnet}
                    %      endif
                    ##
                    %      if mgmtVlans[0]["commonVlanVIP"]:
                    ip route 0.0.0.0/0 ${mgmtVlans[0]["commonVlanVIP"]}
                    %      endif
                    ##
                    %    endif
                    %  endif    # myRole == spline or leaf

                    %  if myRole == "spline":
                        <% downlinkPortChannelGenerated = {} %>
                         ## One port channel down to each POD
                    %    if downlinkDetails:
                    %      for intfName, params in downlinkDetails.items():
                             <%
                                intfParams = params["downlinkInterfaceParameters"]
                                pch =  intfParams["downlinkChannelNum"]
                             %>
                    interface ${intfName}
                        description Connects to Campus POD
                        channel-group ${pch} mode ${lacpMode}
                    %        if mgmtVlans:
                        switchport access vlan ${mgmtVlans[0]["commonVlanID"]}
                    %        endif
                    %        if pch in downlinkPortChannelGenerated:
                               <% continue %>
                    %        endif
                             <% downlinkPortChannelGenerated[pch] = True %>
                    interface port-channel ${pch}
                        switchport
                    %    if (mySplineRole == "Primary" or mySplineRole == "Secondary"):
                        mlag ${pch}
                    %    endif
                        switchport mode trunk
                    %        if mgmtVlans:
                        switchport trunk native vlan ${mgmtVlans[0]["commonVlanID"]}
                    %        endif
                    %      endfor # for downlinkDetails
                    %    endif    # if downlinkDetails

                    %    if externalUplinkDetails:
                    %      for intfName, params in externalUplinkDetails.items():
                    interface ${intfName}
                        description Uplink to external network
                        no switchport
                        ip address ${params.get("externalUplinkIPSubnet")}
                    %        if params.get("externalUplinkMTU"):
                        mtu ${params.get("externalUplinkMTU")}
                    %        endif
                    %        if params.get("externalUplinkSpeed") == "auto":
                        speed auto
                    %        else:
                        speed forced ${params.get("externalUplinkSpeed")}
                    %        endif
                    %      endfor
                    %    endif    # externalUplinkDetails
                    ip routing
                    ip virtual-router mac-address ${virtualRouterMacAddress}
                    ######
                    %    if (mySplineRole == "Primary" or mySplineRole == "Secondary"):
                    ######
                    ${mlagConfig()}
                    %    endif
                    %  elif myRole == "leaf":
                    %    for intfName, params in leafUplinkDetails.items():
                    %      if myLeafRole == "Primary" or myLeafRole == "Secondary" or myLeafRole == "Member":
                             ## Same port-channel from each leaf
                             <% group = params["leafUplinkChannelGroup"] %>
                    %      elif myLeafRole == "None":
                             ## Separate port-channel from each leaf
                             <% group = params["leafUplinkChannelGroup"] + loop.index %>
                    %      endif

                    interface ${intfName}
                        channel-group ${group} mode ${lacpMode}
                    %      if myLeafRole == "None" or loop.index == 0:    # one port-channel block
                    interface port-channel ${group}
                    %      if myLeafRole == "Primary" or myLeafRole == "Secondary":
                        description Uplink to Spline
                        switchport
                        mlag ${group}
                    %      elif myLeafRole == "Member":
                        description Uplink
                    %      else:     # myLeafRole == "None"
                        description Uplink to Spline
                    %      endif
                        switchport
                        switchport mode trunk
                    %      if mgmtVlans:   # Always use native vlan for managment
                        switchport access vlan ${mgmtVlans[0]["commonVlanID"]}
                        switchport trunk native vlan ${mgmtVlans[0]["commonVlanID"]}
                    %      endif
                    %      endif    # port-channel block

                    %    endfor   # each uplink

                    %    for intfName, params in leafDownlinkDetails.items():
                        <% group = params["leafDownlinkChannelGroup"] %>
                    interface ${intfName}
                        channel-group ${group} mode ${lacpMode}
                    interface port-channel ${group}
                        description Downlink to member switches
                        switchport
                        switchport mode trunk
                    ##
                    %      if mgmtVlans:
                        switchport access vlan ${mgmtVlans[0]["commonVlanID"]}
                        switchport trunk native vlan ${mgmtVlans[0]["commonVlanID"]}
                    %    endif
                    ##
                        mlag ${group}
                    %    endfor   # each downlink

                    %    if (myLeafRole == "Primary" or myLeafRole == "Secondary") and len(podDevices) > 1:
                    ${mlagConfig()}
                    %    endif

                    %  endif  # myRole == spline or leaf

                    <%def name="mlagConfig()" filter="trim">
                    !
                    %  for peerLinkMember in peerLinkMembers:
                    interface ${peerLinkMember}
                        description MLAG peer link member
                    %    if lacpMode is not None:
                        channel-group ${mlagPortChannelId} mode ${lacpMode}
                    %    endif
                    %  endfor
                    interface port-channel ${mlagPortChannelId}
                        description MLAG peer link
                        switchport
                        switchport mode trunk
                        switchport trunk group MLAG-PEER
                    vlan ${mlagVlan}
                        trunk group MLAG-PEER
                    no spanning-tree vlan-id ${mlagVlan}
                    interface vlan ${mlagVlan}
                        ip address ${myMlagIP}/31
                        no autostate
                    mlag configuration
                        domain-id MLAG
                        local-interface vlan ${mlagVlan}
                        peer-address ${peerMlagIP}
                        peer-link port-channel ${mlagPortChannelId}
                    !
                    </%def>
            input_schema:
                fields:
                    values:
                        fabricType:
                            id: fabricType
                            name: fabricType
                            label: 'Fabric Type'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: 'L2 MLAG'
                                static_options:
                                    values:
                                        - 'L2 MLAG'
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        mlagLinkSubnet:
                            id: mlagLinkSubnet
                            name: mlagPeerLinkSubnet
                            label: 'MLAG Peer Link Subnet'
                            description: 'Enter in CIDR notation'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: 169.254.0.0/31
                                static_options: null
                                format: cidr
                                length: null
                                pattern: null
                                dynamic_options: null
                        internalVlan:
                            id: internalVlan
                            name: mlagVlan
                            label: 'MLAG Peer Link VLAN'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_INTEGER
                            integer_props:
                                default_value: '4094'
                                range: null
                                static_options: null
                                dynamic_options: null
                        mlagPortChannelId:
                            id: mlagPortChannelId
                            name: mlagPortChannelId
                            label: 'MLAG Port Channel Number'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_INTEGER
                            integer_props:
                                default_value: '2000'
                                range: null
                                static_options: null
                                dynamic_options: null
                        virtualRouterMac:
                            id: virtualRouterMac
                            name: virtualRouterMacAddress
                            label: 'Virtual Router MAC Address'
                            description: 'Enter a common virtual MAC address for the gateways'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: '00:1c:73:00:00:99'
                                static_options: null
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        mlagSubnetMask:
                            id: mlagSubnetMask
                            name: mlagSubnetMask
                            label: 'MLAG Subnet Mask'
                            description: 'Set the size of the MLAG subnet'
                            required: false
                            type: INPUT_FIELD_TYPE_INTEGER
                            integer_props:
                                default_value: '31'
                                range: null
                                static_options:
                                    values:
                                        - '31'
                                        - '30'
                                dynamic_options: null
                        lacpMode:
                            id: lacpMode
                            name: lacpMode
                            label: 'LACP Mode'
                            description: 'Set the link aggregation mode for the MLAG peer link'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: active
                                static_options:
                                    values:
                                        - active
                                        - passive
                                        - 'on'
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        commonMlagConfig:
                            id: commonMlagConfig
                            name: commonMlagConfig
                            label: 'MLAG Configuration'
                            description: 'Global MLAG parameters defined for the campus fabric.'
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - mlagLinkSubnet
                                        - internalVlan
                                        - mlagPortChannelId
                                        - virtualRouterMac
                                        - mlagSubnetMask
                                        - lacpMode
                        commonVlanID:
                            id: commonVlanID
                            name: commonVlanID
                            label: 'VLAN ID'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_INTEGER
                            integer_props:
                                default_value: null
                                range: 1..4094
                                static_options: null
                                dynamic_options: null
                        commonVlanName:
                            id: commonVlanName
                            name: commonVlanName
                            label: Name
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        commonVlanIsMgmt:
                            id: commonVlanIsMgmt
                            name: commonVlanIsMgmt
                            label: 'Management VLAN'
                            description: 'Use VLAN for in-band management'
                            required: false
                            type: INPUT_FIELD_TYPE_BOOLEAN
                            boolean_props:
                                default_value: false
                        commonVlanVIP:
                            id: commonVlanVIP
                            name: commonVlanVIP
                            label: 'SVI Virtual IP Address'
                            description: 'Enter a default gateway for the campus subnets'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: ip
                                length: null
                                pattern: null
                                dynamic_options: null
                        IPHelperAddress:
                            id: IPHelperAddress
                            name: IPHelperAddress
                            label: 'IP Helper Address'
                            description: 'Enter the IP address or hostname of the DHCP server'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        commonvrf:
                            id: commonvrf
                            name: vrf
                            label: VRF
                            description: Optional
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        commonVlan:
                            id: commonVlan
                            name: commonVlan
                            label: 'VLAN configuration'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - commonVlanID
                                        - commonVlanName
                                        - commonVlanIsMgmt
                                        - commonVlanVIP
                                        - IPHelperAddress
                                        - commonvrf
                        commonVlans:
                            id: commonVlans
                            name: commonVlans
                            label: VLAN
                            description: 'Define networks deployed within the campus. Device-specific addressing is configured within each campus Spline and pod.'
                            required: false
                            type: INPUT_FIELD_TYPE_COLLECTION
                            collection_props:
                                base_field_id: commonVlan
                                key: null
                        splineRole:
                            id: splineRole
                            name: splineRole
                            label: 'MLAG Role'
                            description: 'Set the MLAG role for the campus Spline, which provides an arbitrary assignment of the Spline within the topology. MLAG will auto-negotiate the primary-secondary operational status.'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options:
                                    values:
                                        - Primary
                                        - Secondary
                                        - None
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        splineVlanID:
                            id: splineVlanID
                            name: splineVlanID
                            label: 'VLAN ID'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_INTEGER
                            integer_props:
                                default_value: null
                                range: null
                                static_options: null
                                dynamic_options:
                                    values:
                                        - '{"fieldId": "commonVlanID"}'
                        splineVlanIPSubnet:
                            id: splineVlanIPSubnet
                            name: splineVlanIPSubnet
                            label: 'IP Address and Subnet Mask'
                            description: 'Enter in CIDR notation, e.g. /24'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: cidr
                                length: null
                                pattern: null
                                dynamic_options: null
                        primarySecondary:
                            id: primarySecondary
                            name: primarySecondary
                            label: 'IP Primary Secondary'
                            description: ""
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: Primary
                                static_options:
                                    values:
                                        - Primary
                                        - Secondary
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        splineVlan:
                            id: splineVlan
                            name: splineVlan
                            label: 'VLAN configuration'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - splineVlanID
                                        - splineVlanIPSubnet
                                        - primarySecondary
                        splineVlans:
                            id: splineVlans
                            name: splineVlans
                            label: 'SVI Configuration'
                            description: 'Define a device-specific IP address in CIDR notation for each campus network.'
                            required: false
                            type: INPUT_FIELD_TYPE_COLLECTION
                            collection_props:
                                base_field_id: splineVlan
                                key: null
                        splineInbandMgmtIPSubnet:
                            id: splineInbandMgmtIPSubnet
                            name: splineInbandMgmtIPSubnet
                            label: 'Loopback IP address'
                            description: 'Configure an optional loopback interface in CIDR notation for device management.'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: cidr
                                length: null
                                pattern: null
                                dynamic_options: null
                        externalUplinkIPSubnet:
                            id: externalUplinkIPSubnet
                            name: externalUplinkIPSubnet
                            label: 'IP Address and Subnet Mask'
                            description: 'Enter in CIDR notation, e.g. /24'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: cidr
                                length: null
                                pattern: null
                                dynamic_options: null
                        externalUplinkMTU:
                            id: externalUplinkMTU
                            name: externalUplinkMTU
                            label: MTU
                            description: 'Define an MTU value (max. 9214)'
                            required: false
                            type: INPUT_FIELD_TYPE_INTEGER
                            integer_props:
                                default_value: null
                                range: null
                                static_options: null
                                dynamic_options: null
                        externalUplinkSpeed:
                            id: externalUplinkSpeed
                            name: externalUplinkSpeed
                            label: 'Link Speed'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: auto
                                static_options: null
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        externalUplink:
                            id: externalUplink
                            name: externalUplink
                            label: 'Uplink to External Network'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - externalUplinkIPSubnet
                                        - externalUplinkMTU
                                        - externalUplinkSpeed
                        externalUplinkResolver:
                            id: externalUplinkResolver
                            name: externalUplinkResolver
                            label: 'Uplink to External Network'
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_RESOLVER
                            resolver_props:
                                base_field_id: externalUplink
                                display_mode: RESOLVER_FIELD_DISPLAY_MODE_SPARSE
                                input_mode: RESOLVER_FIELD_INPUT_MODE_SINGLE_INTERFACE_TAG
                                input_tag_label: interface
                                tag_filter_query: null
                        spline:
                            id: spline
                            name: spline
                            label: 'Spline Configuration'
                            description: 'Configuration for the interfaces that connect to Primary and Secondary in each Campus POD'
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - splineRole
                                        - splineVlans
                                        - splineInbandMgmtIPSubnet
                                        - externalUplinkResolver
                        splinePicker:
                            id: splinePicker
                            name: splinePicker
                            label: 'Campus Spline Devices'
                            description: 'Configure campus Spline devices for the campus fabric.'
                            required: false
                            type: INPUT_FIELD_TYPE_RESOLVER
                            resolver_props:
                                base_field_id: spline
                                display_mode: RESOLVER_FIELD_DISPLAY_MODE_SPARSE
                                input_mode: RESOLVER_FIELD_INPUT_MODE_SINGLE_DEVICE_TAG
                                input_tag_label: device
                                tag_filter_query: null
                        leafRole:
                            id: leafRole
                            name: leafRole
                            label: 'MLAG Role'
                            description: 'Primary and secondary form an MLAG pair, and all other devices are members.'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options:
                                    values:
                                        - Primary
                                        - Secondary
                                        - Member
                                        - None
                                format: null
                                length: null
                                pattern: null
                                dynamic_options: null
                        leafInbandMgmtIPSubnet:
                            id: leafInbandMgmtIPSubnet
                            name: leafInbandMgmtIPSubnet
                            label: 'In-band Management IP Address and Subnet Mask'
                            description: 'Enter in CIDR notation'
                            required: false
                            type: INPUT_FIELD_TYPE_STRING
                            string_props:
                                default_value: null
                                static_options: null
                                format: cidr
                                length: null
                                pattern: null
                                dynamic_options: null
                        leaf:
                            id: leaf
                            name: leaf
                            label: 'Campus Leaf Details'
                            description: 'Add, remove, and configure campus leaf devices in this pod.'
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - leafRole
                                        - leafInbandMgmtIPSubnet
                        leafs:
                            id: leafs
                            name: leafs
                            label: 'Campus Leaf Devices'
                            description: 'Add, remove, and configure campus leaf devices in this pod.'
                            required: false
                            type: INPUT_FIELD_TYPE_RESOLVER
                            resolver_props:
                                base_field_id: leaf
                                display_mode: RESOLVER_FIELD_DISPLAY_MODE_SPARSE
                                input_mode: RESOLVER_FIELD_INPUT_MODE_SINGLE_DEVICE_TAG
                                input_tag_label: device
                                tag_filter_query: null
                        pod:
                            id: pod
                            name: pod
                            label: 'Pod Configuration'
                            description: 'Configuration specific to a particular POD'
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - leafs
                        podPicker:
                            id: podPicker
                            name: podPicker
                            label: 'Campus Pod'
                            description: 'Configure campus leaf devices within campus pod groupings.'
                            required: false
                            type: INPUT_FIELD_TYPE_RESOLVER
                            resolver_props:
                                base_field_id: pod
                                display_mode: RESOLVER_FIELD_DISPLAY_MODE_SPARSE
                                input_mode: RESOLVER_FIELD_INPUT_MODE_SINGLE_DEVICE_TAG
                                input_tag_label: Campus-Pod
                                tag_filter_query: null
                        campus:
                            id: campus
                            name: campus
                            label: Campus
                            description: null
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - fabricType
                                        - commonMlagConfig
                                        - commonVlans
                                        - splinePicker
                                        - podPicker
                        campusPicker:
                            id: campusPicker
                            name: campusPicker
                            label: Campus
                            description: 'Manage campus configuration, including all campus leafs.'
                            required: false
                            type: INPUT_FIELD_TYPE_RESOLVER
                            resolver_props:
                                base_field_id: campus
                                display_mode: RESOLVER_FIELD_DISPLAY_MODE_SPARSE
                                input_mode: RESOLVER_FIELD_INPUT_MODE_SINGLE_DEVICE_TAG
                                input_tag_label: Campus
                                tag_filter_query: null
                        root:
                            id: root
                            name: ""
                            label: ""
                            description: ""
                            required: false
                            type: INPUT_FIELD_TYPE_GROUP
                            group_props:
                                members:
                                    values:
                                        - campusPicker
                layout:
                    value: '{}'
